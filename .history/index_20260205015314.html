<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Samsung Advisor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f4f6f9; font-family: 'Segoe UI', sans-serif; min-height: 100vh; display: flex; align-items: center; justify-content: center; }
        .card { width: 100%; max-width: 850px; padding: 40px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.08); border: none; background: white; }
        .btn-primary { background-color: #1456cc; border: none; padding: 12px; font-weight: 600; transition: 0.3s; }
        .btn-primary:hover { background-color: #0f44a3; }
        .table th { background-color: #f1f3f5; font-size: 0.9rem; color: #495057; }
        .search-box { border-radius: 10px; padding: 12px; border: 2px solid #e9ecef; }
        .search-box:focus { border-color: #1456cc; box-shadow: none; }
    </style>
</head>
<body>

    <div class="card">
        <div class="text-center mb-5">
            <h2 class="fw-bold mb-2">üì± Samsung Advisor</h2>
            <p class="text-muted">Ask about any Galaxy phone (e.g., Samsung S23)</p>
        </div>
        
        <div class="mb-4">
            <input type="text" id="question" class="form-control search-box mb-3" placeholder="Samsung S23 vs Samsung S24" onkeypress="handleEnter(event)">
            <button class="btn btn-primary w-100 rounded-3" onclick="askQuestion()">Get Details</button>
        </div>

        <div id="loading" class="text-center py-4" style="display: none;">
            <div class="spinner-border text-primary" role="status"></div>
            <p class="mt-2 text-muted small">Searching database & web...</p>
        </div>

        <div id="result" class="mt-4"></div>
    </div>

    <script>
        function handleEnter(e) {
            if (e.key === "Enter") askQuestion();
        }

        async function askQuestion() {
            const question = document.getElementById("question").value.trim();
            const resultDiv = document.getElementById("result");
            const loadingDiv = document.getElementById("loading");

            if (!question) return;

            resultDiv.innerHTML = "";
            loadingDiv.style.display = "block";

            try {
                // IMPORTANT: Relative path used here for deployment
                const response = await fetch(`/ask?question=${encodeURIComponent(question)}`, {
                    method: "POST"
                });

                if (!response.ok) {
                    throw new Error(`Server error: ${response.status}`);
                }

                const data = await response.json();
                loadingDiv.style.display = "none";

                // Scenario 1: Comparison
                if (data.mode === "comparison") {
                    const p1 = data.phone1;
                    const p2 = data.phone2;
                    
                    resultDiv.innerHTML = `
                        <div class="table-responsive">
                            <h5 class="text-center mb-4 fw-bold text-dark">Comparison Table</h5>
                            <table class="table table-bordered text-center align-middle">
                                <thead class="table-light">
                                    <tr>
                                        <th style="width: 20%">Feature</th>
                                        <th style="width: 40%" class="text-primary">${p1.model || "Phone 1"}</th>
                                        <th style="width: 40%" class="text-primary">${p2.model || "Phone 2"}</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${generateRow("Release", p1.release_date, p2.release_date)}
                                    ${generateRow("Display", p1.display, p2.display)}
                                    ${generateRow("Battery", p1.battery, p2.battery)}
                                    ${generateRow("Camera", p1.camera, p2.camera)}
                                    ${generateRow("RAM", p1.ram, p2.ram)}
                                    ${generateRow("Storage", p1.storage, p2.storage)}
                                    ${generateRow("Price", "$" + p1.price, "$" + p2.price)}
                                </tbody>
                            </table>
                        </div>`;
                }
                
                // Scenario 2: Single Phone
                else if (data.mode === "single") {
                    const p = data.data;
                    resultDiv.innerHTML = `
                        <div class="p-3 border rounded bg-light">
                            <h4 class="text-center text-primary fw-bold mb-3">${p.model}</h4>
                            <table class="table table-striped mb-0">
                                <tbody>
                                    <tr><th>üìÖ Release</th><td>${p.release_date}</td></tr>
                                    <tr><th>üì± Display</th><td>${p.display}</td></tr>
                                    <tr><th>üîã Battery</th><td>${p.battery}</td></tr>
                                    <tr><th>üì∏ Camera</th><td>${p.camera}</td></tr>
                                    <tr><th>üíæ RAM</th><td>${p.ram}</td></tr>
                                    <tr><th>üíΩ Storage</th><td>${p.storage}</td></tr>
                                    <tr><th>üí∞ Price</th><td>$${p.price}</td></tr>
                                </tbody>
                            </table>
                        </div>`;
                } 
                
                // Scenario 3: Not Found
                else {
                    resultDiv.innerHTML = `
                        <div class="alert alert-warning text-center" role="alert">
                            ‚ö†Ô∏è No data found for "${question}". Try another model.
                        </div>`;
                }

            } catch (error) {
                loadingDiv.style.display = "none";
                resultDiv.innerHTML = `
                    <div class="alert alert-danger text-center" role="alert">
                        Error connecting to server. Make sure backend is running!
                    </div>`;
                console.error(error);
            }
        }

        function generateRow(label, val1, val2) {
            val1 = val1 || "-";
            val2 = val2 || "-";
            return `
                <tr>
                    <td class="fw-bold text-muted small">${label}</td>
                    <td>${val1}</td>
                    <td>${val2}</td>
                </tr>
            `;
        }
    </script>
</body>
</html>